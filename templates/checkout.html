{% extends "base.html" %}
{% block title %} - Checkout{% endblock %}

{% block content %}
<h2 class="section-title text-center mb-4">Checkout</h2>

<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card shadow-sm p-4">
      <h5 class="mb-3">Order Summary</h5>
      <ul class="list-group mb-3">
        {% for it in items %}
        <li class="list-group-item d-flex justify-content-between">
          <div>
            <div class="fw-bold">{{ it.product.name }}</div>
            <div class="small text-muted">Qty: {{ it.quantity }}</div>
          </div>
          <div>Ksh {{ '%.2f'|format(it.subtotal) }}</div>
        </li>
        {% endfor %}
        <li class="list-group-item d-flex justify-content-between">
          <strong>Total</strong>
          <strong>Ksh {{ '%.2f'|format(total) }}</strong>
        </li>
      </ul>

      <form method="POST" id="checkoutForm">
        <h5>Shipping Address</h5>
        <div class="row g-2">
          <div class="col-md-6 mb-2">
            <label class="form-label">Street Name</label>
            <input class="form-control" name="street" required>
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">House Number</label>
            <input class="form-control" name="house_number" required>
          </div>
          <div class="col-12 mb-3">
            <label class="form-label">City</label>
            <input class="form-control" name="city" required>
          </div>
        </div>

        <h5 class="mt-3">Payment Method</h5>
        <select class="form-select mb-3" id="payment_method" name="payment_method" required>
          <option value="" selected disabled>Choose payment method</option>
          <option value="mpesa">M-Pesa</option>
          <option value="credit_card">Credit Card</option>
          <option value="cash">Cash on Delivery / Pay at Premises</option>
        </select>

        <div id="mpesa_block" class="d-none mb-3">
          <label class="form-label">M-Pesa Number</label>
          <input class="form-control" name="mpesa_number" placeholder="07XXXXXXXX">
        </div>

        <div id="card_block" class="d-none">
          <div class="row g-2">
            <div class="col-md-7 mb-2">
              <label class="form-label">Card Number</label>
              <input class="form-control" name="card_number" placeholder="1234 5678 9012 3456">
            </div>
            <div class="col-md-3 mb-2">
              <label class="form-label">Expiry (MM/YY)</label>
              <input class="form-control" name="expiry_date" placeholder="MM/YY">
            </div>
            <div class="col-md-2 mb-2">
              <label class="form-label">CVV</label>
              <input class="form-control" name="cvv" placeholder="123">
            </div>
          </div>
        </div>

        <div id="cash_block" class="d-none mb-3">
          <p class="text-success">Payment will be made in cash on delivery or at our store.</p>
        </div>

        <button class="btn btn-warning btn-lg mt-3" type="submit">Place Order</button>
      </form>
    </div>
  </div>
</div>

{% block scripts %}
<script>
  const pm = document.getElementById('payment_method');
  const mpesa_block = document.getElementById('mpesa_block');
  const card_block = document.getElementById('card_block');
  const cash_block = document.getElementById('cash_block');

  pm && pm.addEventListener('change', function() {
    mpesa_block.classList.add('d-none');
    card_block.classList.add('d-none');
    cash_block.classList.add('d-none');
    if (this.value === 'mpesa') mpesa_block.classList.remove('d-none');
    if (this.value === 'credit_card') card_block.classList.remove('d-none');
    if (this.value === 'cash') cash_block.classList.remove('d-none');
  });
</script>
{% endblock %}
{% endblock %}
